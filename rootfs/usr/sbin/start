#!/bin/sh

#------------------------------------------------------------------------------
# Wait for the network:
#------------------------------------------------------------------------------

RETRIES=20

while [ $RETRIES -gt 0 ]; do
  ip -o a | grep -q eth1 && break
  sleep 1; RETRIES=$((RETRIES - 1))
done

[ $RETRIES -eq 0 ] && {
  echo 'Where is the network?' && exit 1
}

#------------------------------------------------------------------------------
# Configure:
#------------------------------------------------------------------------------

IP=`ip -o a | awk -F"[ /]" '/eth1/ {print $7}'`
echo "$IP $HOSTNAME" > /etc/hosts.conf

#------------------------------------------------------------------------------
# Run:
#------------------------------------------------------------------------------

exec /usr/sbin/dnsmasq -k "$@"
